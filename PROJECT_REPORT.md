# التقرير الفني الشامل: منصة المعلم الذكي (The Smart Teacher)

## 1. نظرة عامة
منصة "المعلم الذكي" هي تطبيق ويب تفاعلي (Single Page Application) مبني باستخدام **React** و **TypeScript**، يهدف لمساعدة المعلمين (خاصة في سوريا) على تحضير الدروس وتوليد الوسائل التعليمية تلقائياً باستخدام نماذج الذكاء الاصطناعي من Google Gemini.

### التقنيات المستخدمة:
- **Core:** React 19, TypeScript, Vite.
- **Styling:** Tailwind CSS (مع خط Tajawal العربي).
- **AI:** Google Gemini API (`gemini-3-flash-preview` للنصوص, `gemini-2.5-flash-image` للصور).
- **Exporting:** `docx` (Word), `pptxgenjs` (PowerPoint), `html2pdf.js` (PDF).
- **Icons:** Lucide React.

---

## 2. هيكلية الملفات (File Structure)

| الملف | الوظيفة |
| :--- | :--- |
| `index.html` | نقطة الدخول، تحتوي على إعدادات Tailwind والخطوط العربية. |
| `App.tsx` | المكون الرئيسي، يدير التنقل بين الصفحات (Dashboard -> Generator -> View). |
| `types.ts` | تعريفات TypeScript لهياكل البيانات (LessonPlan, SlideContent, etc.). |
| `constants.ts` | يحتوي على **هندسة الأوامر (Prompts)** ومخطط البيانات (Schema) الذي يلتزم به الذكاء الاصطناعي. |
| `services/geminiService.ts` | طبقة الخدمة، تحتوي على منطق الاتصال بـ API، وخوارزمية توزيع الوقت. |
| `components/Dashboard.tsx` | الشاشة الرئيسية ولوحة التحكم. |
| `components/LessonGenerator.tsx` | واجهة رفع الملفات وإدخال عنوان الدرس. |
| `components/LessonView.tsx` | واجهة عرض الخطة، التعديل، وتصدير الملفات (Word/PPTX). |

---

## 3. شرح الكود والمنطق البرمجي (Code & Logic)

### أ. الدماغ المفكر (`constants.ts`)
هنا يكمن ذكاء التطبيق. قمنا بتصميم "بروتوكول الشخصيات الثلاث" لضمان جودة المخرجات:

```typescript
export const SYSTEM_PROMPT = `
أنت "الموجه التربوي الذكي"... تقمص ثلاث شخصيات:
1. المعلم الخبير: لصياغة الأهداف التربوية بدقة.
2. موجه التلعيب: لتحويل الدرس إلى لعبة تفاعلية.
3. المصمم المبدع: لوصف الشرائح بصرياً.
...
`;
```
كما نستخدم `LESSON_PLAN_SCHEMA` لفرض هيكلية JSON صارمة على مخرجات النموذج، مما يمنع الأخطاء البرمجية أثناء العرض.

### ب. خدمة الذكاء الاصطناعي (`services/geminiService.ts`)
يحتوي هذا الملف على دالتين رئيسيتين:

1.  **`generateLessonPlan`**:
    *   تقوم بإرسال النص أو الصورة (بعد تحويلها لـ Base64) إلى Gemini.
    *   تطبق خوارزمية **`distributeTimeSmartly`**: وهي خوارزمية ذكية تقوم بحساب "وزن" كل شريحة بناءً على محتواها (لعبة، فيديو، شرح) وتوزع الـ 40 دقيقة (زمن الحصة) عليها بدقة، مع ضمان دقيقة للعنوان ودقيقتين للخاتمة.

2.  **`generateSlideImage`**:
    *   تستخدم نموذج `gemini-2.5-flash-image`.
    *   تحتوي على تعليمات صارمة (Negative Prompts) لمنع توليد نصوص مشوهة داخل الصور، والتركيز على الرسوم التوضيحية (Vector Style).

### ج. واجهة العرض والتصدير (`components/LessonView.tsx`)
هذا هو المكون الأضخم، حيث يدير:
*   **عرض البيانات:** يحول الـ JSON إلى واجهة مستخدم تفاعلية.
*   **التعديل المباشر:** يسمح للمعلم بتعديل أي نص أو شريحة قبل التصدير.
*   **التصدير لـ Word (`generateDocx`):**
    *   قمنا ببرمجة جداول `docx` يدوياً لتطابق "سجل التحضير السوري" تماماً.
    *   يدعم اتجاه النص من اليمين لليสาร (RTL).
    *   يضيف "الهدف العام" و "ملخص الدرس" كما هو مطلوب.

---

## 4. سير العمل (Workflow)

### الخطوة 1: المدخلات (Input)
*   يختار المستخدم "تحضير درس" أو "ماسح الكتب".
*   يتم رفع صورة (يتم تحويلها لـ Base64) أو كتابة عنوان درس.
*   في `LessonGenerator.tsx`، يتم التحقق من حجم الملف وصيغته.

### الخطوة 2: المعالجة (Processing)
*   يتم إرسال البيانات إلى `geminiService`.
*   يقوم Gemini بتحليل الصورة (OCR) واستخراج الأنشطة.
*   يتم توليد خطة الدرس بصيغة JSON وفق الـ Schema المحدد.
*   تقوم خوارزمية الوقت بتعديل أزمنة الشرائح لتساوي 40 دقيقة.

### الخطوة 3: العرض والتعديل (Visualization)
*   يتم نقل البيانات إلى `LessonView`.
*   يتم عرض:
    *   **المصفوفة:** (الأهداف، الإجراءات، التقويم).
    *   **الشرائح:** بطاقات تفاعلية تعرض السيناريو ووصف الصورة.
    *   **التمايز والتأمل:** أقسام جديدة للملاحظات المهنية.
*   يمكن للمعلم الضغط على زر "توليد صورة" لإنشاء صورة خاصة للشريحة باستخدام AI.

### الخطوة 4: التصدير (Export)
*   **DOCX:** يتم بناء ملف وورد معقد يحتوي على الجداول المنسقة (إدارية، مصفوفة، تمايز).
*   **PPTX:** يتم توليد عرض تقديمي بـ 10 شرائح، يحتوي على النصوص والصور المولدة، جاهز للعرض في الصف.
*   **PDF:** يتم تحويل عرض الويب إلى ملف طباعة نظيف.

---

## 5. مقتطفات برمجية هامة

### خوارزمية توزيع الوقت الذكية:
```typescript
// جزء من services/geminiService.ts
const distributeTimeSmartly = (slides) => {
    // حساب وزن المحتوى (لعبة = وزن أكبر)
    if (text.includes("لعبة")) weight += 3.5;
    else if (text.includes("شرح")) weight += 1.5;
    
    // توزيع الوقت المتبقي بناءً على النسبة والتناسب
    let rawDuration = (item.weight / totalWeight) * remainingTime;
};
```

### هيكلية الجدول في ملف Word:
```typescript
// جزء من components/LessonView.tsx
const proceduresTable = new Table({
    width: { size: 100, type: WidthType.PERCENTAGE },
    rows: [
        // صف العناوين
        new TableRow({
            children: [
                createCell("التقويم", 20),
                createCell("مسار الدرس", 40),
                createCell("مخرجات التعلم", 30),
                createCell("الزمن", 10),
            ]
        }),
        // ... صفوف البيانات المستخرجة من AI
    ],
    bidi: true, // تفعيل الاتجاه العربي
});
```

---

## 6. سجل التغييرات (Changelog)

### الإصدار 1.6 (المطابقة البصرية الكاملة - HUD UI)
- **إعادة بناء `LessonView` كلياً:** تم نسخ التصميم المرجعي (الصورة المرفقة) بدقة بكسل-بكسل تقريباً.
- **ثيم الخيال العلمي (Sci-Fi):** اعتماد خلفية زرقاء داكنة جداً (`Slate-950`) مع خطوط شبكية (Grid) وعناصر زجاجية شفافة.
- **تنسيق دقيق (Precision Layout):**
    - الشريط الجانبي للشرائح على اليسار (مع مراعاة الاتجاه العربي للنصوص).
    - مصفوفة الدرس (الأهداف/الإجراءات) كجدول شفاف على اليمين.
    - أزرار التصدير بتصميم "Pill" مع حدود ذهبية مضيئة.
- **مؤثرات بصرية:** إضافة توهج (Glow) وحدود متدرجة (Gradient Borders) لمحاكاة واجهات HUD.

---
*آخر تحديث: 2024-05-20 (Auto-Generated Report)*
